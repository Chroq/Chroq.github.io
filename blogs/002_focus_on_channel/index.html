<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=icon href=/images/white-cloud-002.webp type=image/gif><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Alata&family=Oswald:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Alata&family=Oswald:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" media=print onload='this.media="all"'><noscript><link href="https://fonts.googleapis.com/css2?family=Alata&family=Oswald:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel=stylesheet></noscript><link rel=stylesheet href=/css/font.css media=all><meta property="og:title" content="Focus sur les channels"><meta property="og:description" content="Ce second article reprends la notion de channel en Go et détaille les différents usages dans un contexte de "><meta property="og:type" content="article"><meta property="og:url" content="https://christophe-lecroq.dev/blogs/002_focus_on_channel/"><meta property="article:section" content="blogs"><meta property="article:published_time" content="2022-11-21T11:11:24+02:00"><meta property="article:modified_time" content="2022-11-21T11:11:24+02:00"><meta property="og:site_name" content="Christophe Lecroq"><meta name=twitter:card content="summary"><meta name=twitter:title content="Focus sur les channels"><meta name=twitter:description content="Ce second article reprends la notion de channel en Go et détaille les différents usages dans un contexte de "><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi crossorigin=anonymous><link rel=stylesheet href=/css/header.css media=all><link rel=stylesheet href=/css/footer.css media=all><link rel=stylesheet href=/css/theme.css media=all><style>:root{--text-color:#343a40;--text-secondary-color:#6c757d;--secondary-background-color:#64ffda1a;--primary-color:#007bff;--secondary-color:#f8f9fa;--text-color-dark:#e4e6eb;--text-secondary-color-dark:#b0b3b8;--secondary-background-color-dark:#212529;--primary-color-dark:#ffffff;--secondary-color-dark:#212529}body{font-size:1rem;font-weight:400;line-height:1.5;text-align:left}</style><meta name=description content="Ce second article reprends la notion de channel en Go et détaille les différents usages dans un contexte de "><link rel=stylesheet href=/css/single.css><title>Focus sur les channels | Christophe Lecroq - Développeur Go & PHP</title></head><body class=light onload=loading()><header><nav class="pt-3 navbar navbar-expand-lg animate"><div class="container-fluid mx-xs-2 mx-sm-5 mx-md-5 mx-lg-5"><a class="navbar-brand primary-font text-wrap" href=/><img src=/images/white-cloud-002.webp width=30 height=30 class="d-inline-block align-top">
Christophe Lecroq</a>
<button class=navbar-toggler type=button data-toggle=collapse href=#navbarContent aria-controls=navbarContent aria-expanded=false aria-label="Toggle navigation"><svg aria-hidden="true" height="24" viewBox="0 0 16 16" width="24" data-view-component="true"><path fill-rule="evenodd" d="M1 2.75A.75.75.0 011.75 2h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 2.75zm0 5A.75.75.0 011.75 7h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 7.75zM1.75 12a.75.75.0 100 1.5h12.5a.75.75.0 100-1.5H1.75z"/></svg></button><div class="collapse navbar-collapse text-wrap primary-font" id=navbarContent><ul class="navbar-nav ms-auto text-center"><li class="nav-item navbar-text"><a class=nav-link href=/blogs title="Blog posts">Blog</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#about aria-label=about>À propos</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#contact aria-label=contact>Contact</a></li></ul></div></div></nav></header><div id=content><section id=single><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-md-12 col-lg-9"><div class=pr-lg-4><div class="title mb-5"><h1 class="text-center mb-4">Focus sur les channels</h1><div class=text-center>Christophe Lecroq
<small>|</small>
21 Nov 2022</div></div><div class=featured-image><img class=img-fluid src=/images/002_focus_on_channel/002_focus_on_channel.webp alt="Focus sur les channels"></div><article class="page-content p-2"><p>Cet article est le second de la série consacrée à la concurrence en Go. Il reprend en détail l&rsquo;utilisation des <code>channels</code>.</p><h2 id=pré-requis>Pré-requis</h2><p>Pour bien suivre ce tutoriel, vous aurez besoin :</p><ul><li>d&rsquo;une installation fonctionnelle de Golang (je travaille sur la version 1.19 mais les concepts expliqués ici existent dans les versions antérieures</li><li>d&rsquo;une connaissance de base du langage Go. Si vous n&rsquo;êtes pas encore familier avec la concurence en Go, je vous encourage à aller lire <a href=/blogs/001_concurrence_go/ target=_blank>le premier article</a> de la série.</li></ul><p>Vous pouvez retrouver tout le code source des exemples (002_*) <a href=https://github.com/Chroq/tutorial target=_blank>ici</a>.</p><h2 id=les-buffered-channels>Les buffered channels</h2><h3 id=bloquant-vs-non-bloquant>Bloquant vs non bloquant</h3><p>En Go, un <code>channel</code> est bloquant par défaut. C&rsquo;est à dire qu&rsquo;il est nécessaire d&rsquo;attribuer une valeur au channel pour pouvoir la lire et ainsi continuer l&rsquo;exécution du programme.
Si vous lancez ce code :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#ae81ff>1.</span>	<span style=color:#a6e22e>c</span>, <span style=color:#a6e22e>c2</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>bool</span>), make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>bool</span>)
</span></span><span style=display:flex><span><span style=color:#ae81ff>2.</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>3.</span>	<span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span><span style=color:#ae81ff>4.</span>		<span style=color:#a6e22e>c</span> <span style=color:#f92672>&lt;-</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>5.</span>		<span style=color:#a6e22e>c2</span> <span style=color:#f92672>&lt;-</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>6.</span>	}()
</span></span><span style=display:flex><span><span style=color:#ae81ff>7.</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>8.</span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>c2</span>,<span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>c</span>)
</span></span></code></pre></div><p>Vous recevrez un message du type : <code>fatal error: all goroutines are asleep - deadlock! goroutine 1 [chan receive]:</code>. Lorsque le programme va s&rsquo;exécuter, il écrit dans le channel <code>c</code> (ligne 4) puis cherche à lire cette valeur. Ici, c&rsquo;est <code>c2</code> qui est appelé en premier sauf que lui n&rsquo;a aucune valeur. Le programme détecte alors un <code>deadlock</code> puisqu&rsquo;il ne peut plus continuer son exécution.</p><p>Le même code en réordonnant la lecture des channels ne générera plus d&rsquo;erreur.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span>	<span style=color:#a6e22e>c</span>, <span style=color:#a6e22e>c2</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>bool</span>), make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>bool</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>c</span> <span style=color:#f92672>&lt;-</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>c2</span> <span style=color:#f92672>&lt;-</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>	}()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>c</span>, <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>c2</span>)
</span></span></code></pre></div><p>L&rsquo;exécution du code suivant retournera : <code>true false</code></p><p>Il existe plusieurs manières de rendre non bloquant un channel, je ne parlerais ici que de celle concernant <code>les channels</code> mais sachez qu&rsquo;il est possible aussi de contourner le mécanisme avec l&rsquo;instruction <code>select</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span>	<span style=color:#a6e22e>c</span>, <span style=color:#a6e22e>c2</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>bool</span>, <span style=color:#ae81ff>1</span>), make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>bool</span>, <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>c</span> <span style=color:#f92672>&lt;-</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>c2</span> <span style=color:#f92672>&lt;-</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>	}()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>c2</span>, <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>c</span>)
</span></span></code></pre></div><p>Dans l&rsquo;extrait ci-dessus, on déclare un channel avec un buffer de 1. Les channels ayant une taille de buffer dans l&rsquo;instruction <code>make</code> sont <strong>non bloquants</strong>, c&rsquo;est à dire que le traitement va continuer même si le channel n&rsquo;est pas lu directement.</p><p>Notez que j&rsquo;ai replacé les paramètres de l&rsquo;instruction <code>Println</code> dans l&rsquo;ordre qui avait généré le <code>deadlock</code> tout à l&rsquo;heure. Si vous exécuter ce code, vous aurez comme sortie <code>false true</code></p><p>Pour conclure sur cette notion de blocage, il s&rsquo;agit d&rsquo;un mécanisme pratique pour ne pas avoir à gérer explicitement le blocage des channels. Cependant, vous aurez sans doute des cas de figure dans lesquels vous souhaitez gérer vous-même ce comportement pour couvrir votre cas d&rsquo;usage.</p><h4 id=itérer-sur-un-channel>Itérer sur un channel</h4><p>Pour parcourir un <code>buffered channel</code>, Golang permet à l&rsquo;aide de la boucle <code>for</code> et du mot clé <code>range</code> d&rsquo;itérer sur les valeurs de votre channel. Vous pouvez donc organiser vos traitements et leurs résultats associés.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>c</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>, <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>c</span> <span style=color:#f92672>&lt;-</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>c</span> <span style=color:#f92672>&lt;-</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>		close(<span style=color:#a6e22e>c</span>)
</span></span><span style=display:flex><span>	}()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>v</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>c</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>v</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>La sortie sera donc :</p><pre tabindex=0><code>2
1
</code></pre><p>Selon ce que vous cherchez à réaliser, l&rsquo;utilisation d&rsquo;un channel avec buffer peut impliquer l&rsquo;utilisation de la fonction <code>close</code> sur votre channel. En effet, si vous n&rsquo;indiquez pas à votre programme que vous ne souhaitez plus continuer à utiliser ce channel, le programme considérera que vous devez encore écrire dedans et paniquera avec une erreur <code>deadlock</code>.</p><h3 id=cas-pratique>Cas pratique</h3><p>Reprenons l&rsquo;exemple de l&rsquo;article précédent, Legolas et Gandalf versus le Balrog. Pour démontrer l&rsquo;intéret des <code>buffered channels</code>, j&rsquo;ai ajouté quelques contraintes :</p><ul><li>Legolas a un nombre limité de flèches. Dans mon exemple, je limite la taille du buffer à 3.</li><li>Laisser Legolas agir en premier et Gandalf terminer en boucle jusqu&rsquo;à la fin du &ldquo;traitement&rdquo;</li><li>Utiliser un channel <code>dead</code> pour gérer l&rsquo;information de fin de traitement plutôt que de passer les channels à nul. Il s&rsquo;agit d&rsquo;une façon plus idomatique de faire.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>BalrogHP</span> = <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>LegolasShootArrows</span>(<span style=color:#a6e22e>damage</span> <span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>damage</span> <span style=color:#f92672>&lt;-</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>damage</span> <span style=color:#f92672>&lt;-</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>damage</span> <span style=color:#f92672>&lt;-</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>	close(<span style=color:#a6e22e>damage</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>GandalfCastsSpell</span>(<span style=color:#a6e22e>dead</span> <span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>bool</span>, <span style=color:#a6e22e>damage</span> <span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> !<span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>dead</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>damage</span> <span style=color:#f92672>&lt;-</span> <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>DisplayBalrogHP</span>(<span style=color:#a6e22e>dead</span> <span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>bool</span>, <span style=color:#a6e22e>LegolasDamage</span>, <span style=color:#a6e22e>GandalfDamage</span> <span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>balrogHP</span> = <span style=color:#a6e22e>BalrogHP</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Print</span>(<span style=color:#e6db74>&#34;Balrog is coming ! &#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>balrogHP</span> &gt; <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>balrogHP</span> &gt; <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>dead</span> <span style=color:#f92672>&lt;-</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Balrog HP : %d\n&#34;</span>, <span style=color:#a6e22e>balrogHP</span>)
</span></span><span style=display:flex><span>		} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>dead</span> <span style=color:#f92672>&lt;-</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>incomingDamage</span> <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>damage</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>LegolasDamage</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Legolas shoots an arrow and deals %d damages ! \n&#34;</span>, <span style=color:#a6e22e>damage</span>)
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>incomingDamage</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>damage</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>open</span> <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>incomingDamage</span>, <span style=color:#a6e22e>open</span> = <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>GandalfDamage</span>; <span style=color:#a6e22e>open</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Gandalf casts a spell and deals %d damages ! \n&#34;</span>, <span style=color:#a6e22e>incomingDamage</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>balrogHP</span> <span style=color:#f92672>-=</span> <span style=color:#a6e22e>incomingDamage</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Balrog is dead !&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>dead</span>, <span style=color:#a6e22e>LegolasDamage</span>, <span style=color:#a6e22e>GandalfDamage</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>bool</span>), make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>, <span style=color:#ae81ff>3</span>), make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>go</span> <span style=color:#a6e22e>LegolasShootArrows</span>(<span style=color:#a6e22e>LegolasDamage</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>go</span> <span style=color:#a6e22e>GandalfCastsSpell</span>(<span style=color:#a6e22e>dead</span>, <span style=color:#a6e22e>GandalfDamage</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>go</span> <span style=color:#a6e22e>DisplayBalrogHP</span>(<span style=color:#a6e22e>dead</span>, <span style=color:#a6e22e>LegolasDamage</span>, <span style=color:#a6e22e>GandalfDamage</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>a</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Scanln</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>a</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>La sortie sera la suivante :</p><pre tabindex=0><code>Balrog is coming ! Balrog HP : 20
Legolas shoots an arrow and deals 1 damages !
Legolas shoots an arrow and deals 2 damages !
Legolas shoots an arrow and deals 3 damages !
Gandalf casts a spell and deals 5 damages ! 
Balrog HP : 15
Gandalf casts a spell and deals 5 damages ! 
Balrog HP : 10
Gandalf casts a spell and deals 5 damages ! 
Balrog HP : 5
Gandalf casts a spell and deals 5 damages ! 
Balrog is dead !
</code></pre><p>Vous noterez que le code a été agencé un peu différemment que dans la première version. Tout d&rsquo;abord, pour ordonner les actions, j&rsquo;ai supprimé l&rsquo;instruction <code>select</code> pour gérer la boucle <code>for</code> puis la structure conditionnelle <code>if</code>.</p><p>Enfin, vous aurez peut-être noté la présence d&rsquo;un booléen <code>open</code> utilisé lors de l&rsquo;assignation de la valeur stockée dans le <code>channel</code> de Gandalf, ligne 40. Étant donné que je ne gère pas un <code>buffered channel</code>, ce booléen sera toujours à <code>true</code>. Je n&rsquo;ai cependant pas le choix que de le gérer si je veux vous montrer comment récupérer une valeur d&rsquo;un channel dans une condition.</p><h2 id=conclusion>Conclusion</h2><p>Les <code>channels</code> sont les outils de base pour gérer les échanges d&rsquo;informations entre vos différentes <code>goroutines</code>. N&rsquo;hésitez pas à vous entrainez pour bien appréhender leurs principes de fonctionnement. Le prochain article de la série continuera de traiter de la concurrence mais au travers du package <code>sync</code>.</p></article></div></div><div class="col-sm-12 col-md-12 col-lg-3"><div class=sticky-sidebar><aside class=toc><h5>Table des matières</h5><div class=toc-content><nav id=TableOfContents><ul><li><a href=#pré-requis>Pré-requis</a></li><li><a href=#les-buffered-channels>Les buffered channels</a><ul><li><a href=#bloquant-vs-non-bloquant>Bloquant vs non bloquant</a></li><li><a href=#cas-pratique>Cas pratique</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></aside><aside class=tags><h5>Tags</h5><ul class="tags-ul list-unstyled list-inline"><li class=list-inline-item><a href=https://christophe-lecroq.dev/tags/golang target=_blank>Golang</a></li><li class=list-inline-item><a href=https://christophe-lecroq.dev/tags/concurrence target=_blank>Concurrence</a></li><li class=list-inline-item><a href=https://christophe-lecroq.dev/tags/channel target=_blank>Channel</a></li><li class=list-inline-item><a href=https://christophe-lecroq.dev/tags/asynchrone target=_blank>Asynchrone</a></li></ul></aside></div></div></div><div class=row><div class="col-sm-12 col-md-12 col-lg-9 p-4"></div></div></div><button class="p-2 px-3" onclick=topFunction() id=topScroll>
<i class="fas fa-angle-up"></i></button></section><script>var topScroll=document.getElementById("topScroll");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?topScroll.style.display="block":topScroll.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script></div><footer><div class="container py-3" id=recent-posts></div><div class="text-center pt-2"></div><div class="container py-4"><div class="row justify-content-center"><div class="col-md-4 text-center"><div class=pb-2><a href=https://christophe-lecroq.dev title="Christophe Lecroq - Développeur Go & PHP"><img alt="Christophe Lecroq Logo" src=/images/white-cloud-002.webp height=200px width=200px></a></div>&copy; 2023 All Rights Reserved<div class=text-secondary>Made with
<span class=text-danger>&#10084;</span>
and
<a href=https://github.com/gurusabarish/hugo-profile target=_blank title="Designed and developed by gurusabarish">Hugo Profile</a></div></div></div></div></footer><script src=https://code.jquery.com/jquery-3.5.1.slim.min.js integrity=sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js integrity=sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s crossorigin=anonymous></script>
<script>document.body.className.includes("light")&&(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))</script><script>let loadingIcons;function loading(){myVar=setTimeout(showPage,100)}function showPage(){try{document.getElementById("loading-icons").style.display="block"}catch{}}</script></body></html>